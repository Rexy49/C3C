<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>4D Box Chart Comparator</title>
<style>
  /* Basic Reset & Variables for theme */
  :root {
    --primary-color: #3498db;
    --secondary-color: #2980b9;
    --text-color: #2c3e50;
    --bg-color: #f5f7fa;
    --card-bg: #ffffff;
    --border-color: #dfe6e9;
    --success-color: #27ae60;
    --match-color: #2ecc71;
  }
  * {
    box-sizing: border-box;
  }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    background: var(--bg-color);
    color: var(--text-color);
    margin: 0;
    padding: 10px;
    line-height: 1.5;
  }

  /* Container & Headings */
  .container {
    max-width: 1200px;
    margin: 0 auto;
  }
  h1 {
    text-align: center;
    font-size: clamp(1.5rem, 5vw, 2rem);
    margin-bottom: 10px;
    color: var(--text-color);
  }
  .description {
    text-align: center;
    margin-bottom: 15px;
    font-size: 0.9rem;
    color: #7f8c8d;
  }

  /* Charts Layout */
  .chart-container {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
  }
  .chart-box {
    background: var(--card-bg);
    border-radius: 8px;
    padding: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 380px;
  }
  .chart-title {
    text-align: center;
    margin-bottom: 12px;
    font-weight: 600;
    color: var(--primary-color);
    font-size: 1.1rem;
  }
  /* Input grid for charts (larger cells) */
  #inputGrid1, #inputGrid2 {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 6px;
  }
  #inputGrid1 input, #inputGrid2 input {
    font-size: 24px;
    padding: 8px;
    aspect-ratio: 1 / 1;
    text-align: center;
    border: 1px solid var(--primary-color);
    border-radius: 6px;
    background: var(--card-bg);
    font-weight: bold;
    transition: all 0.2s;
  }
  input:focus {
    outline: none;
    border-color: var(--secondary-color);
    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
  }

  /* Buttons */
  .buttons {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
    margin: 15px 0;
  }
  button {
    font-size: clamp(14px, 4vw, 15px);
    padding: 8px 12px;
    background-color: var(--primary-color);
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    flex: 1 1 auto;
    min-width: 120px;
    max-width: 180px;
    transition: background-color 0.2s;
  }
  button:hover {
    background-color: var(--secondary-color);
  }
  button:disabled {
    background-color: #95a5a6;
    cursor: not-allowed;
    opacity: 0.7;
  }

  /* Results area */
  #output {
    margin-top: 20px;
  }
  .results-container {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
  }
  .results-box {
    background: var(--card-bg);
    border-radius: 8px;
    padding: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 380px;
  }
  .category {
    margin-bottom: 12px;
  }
  .category h3 {
    margin: 0 0 8px 0;
    font-size: 1rem;
    font-weight: 600;
    color: var(--primary-color);
    border-bottom: 1px solid var(--primary-color);
    padding-bottom: 4px;
  }
  .results {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
  }
  .number {
    background: #f0f0f0;
    border: 1px solid var(--border-color);
    border-radius: 3px;
    padding: 5px 8px;
    font-family: 'Courier New', monospace;
    font-weight: bold;
    font-size: 11px;
    text-align: center;
    flex: 1 0 calc(25% - 8px);
    max-width: calc(25% - 5px);
  }
  .number.match {
    background-color: var(--match-color);
    color: #fff;
    border-color: var(--match-color);
  }
  .total-count {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--success-color);
    text-align: center;
    margin-bottom: 12px;
  }
  /* Matches Section styling */
  .matches-section {
    width: 100%;
    max-width: 800px;
    margin: 20px auto;
    background: var(--card-bg);
    border-radius: 8px;
    padding: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  .matches-section h2 {
    text-align: center;
    margin-bottom: 12px;
    font-size: 1.2rem;
    color: var(--primary-color);
  }

  /* Export styles for print and image export */
  .export-container {
    background: white;
    padding: 15px;
    max-width: 800px;
    margin: 0 auto;
  }
  .export-header {
    text-align: center;
    margin-bottom: 15px;
    border-bottom: 2px solid var(--primary-color);
    padding-bottom: 10px;
  }
  .export-header h1 {
    margin: 0;
    color: var(--text-color);
    font-size: 1.5rem;
  }
  .export-charts {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    gap: 15px;
    margin-bottom: 15px;
  }
  .export-chart {
    flex: 1;
    min-width: 250px;
  }
  .export-chart-title {
    text-align: center;
    font-weight: bold;
    margin-bottom: 10px;
    color: var(--primary-color);
  }
  .export-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 5px;
  }
  .export-cell {
    border: 1px solid #ddd;
    text-align: center;
    padding: 8px 0;
    font-weight: bold;
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Courier New', monospace;
    font-size: 11px;
  }
  .export-results {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 15px;
  }
  .export-result-box {
    flex: 1;
    min-width: 300px;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 10px;
  }
  .export-category {
    margin-bottom: 10px;
  }
  .export-category h3 {
    margin: 0 0 5px 0;
    font-size: 1rem;
    border-bottom: 1px solid #ccc;
    padding-bottom: 3px;
  }
  /* Responsive adjustments for export view */
  @media(max-width: 768px) {
    .export-results {
      flex-direction: column;
    }
  }

  /* Print styles for clean output */
  @media print {
    body {
      background: #fff;
      padding: 0;
      font-size: 12px;
    }
    .container {
      max-width: 100%;
      padding: 5px;
    }
    .buttons, .export-buttons {
      display: none;
    }
    .chart-box, .results-box, .matches-section {
      box-shadow: none;
      border: 1px solid #ddd;
      page-break-inside: avoid;
    }
    .number {
      padding: 3px 5px;
      font-size: 11px;
    }
  }
</style>
</head>
<body>
<div class="container">
  <h1>4D Box Chart Comparator</h1>
  <p class="description">Enter numbers in both 4x4 charts to generate and compare 4D combinations</p>
  
  <!-- Charts Input -->
  <div class="chart-container">
    <!-- Chart 1 -->
    <div class="chart-box">
      <h3 class="chart-title">Chart 1</h3>
      <div id="inputGrid1"></div>
    </div>
    <!-- Chart 2 -->
    <div class="chart-box">
      <h3 class="chart-title">Chart 2</h3>
      <div id="inputGrid2"></div>
    </div>
  </div>
  
  <!-- Action Buttons -->
  <div class="buttons">
    <button id="generateBtn" onclick="generateCombinations()">Generate & Compare</button>
    <button onclick="resetGrids()">Reset All</button>
  </div>
  
  <!-- Results -->
  <div id="output"></div>
  
  <!-- Export Buttons -->
  <div class="export-buttons" id="exportButtons" style="display:none;">
    <button onclick="exportToText()">Export as Text</button>
    <button onclick="exportToImage()">Export as Image</button>
    <button onclick="window.print()">Print Results</button>
  </div>
</div>

<!-- Hidden Template for Export -->
<div id="exportTemplate" style="display: none;">
  <div class="export-container">
    <div class="export-header">
      <h1>4D Box Chart Comparison Results</h1>
      <p>Generated on <span id="exportDate"></span></p>
    </div>
    <!-- Charts for export -->
    <div class="export-charts">
      <div class="export-chart">
        <div class="export-chart-title">Chart 1</div>
        <div class="export-grid" id="exportGrid1"></div>
      </div>
      <div class="export-chart">
        <div class="export-chart-title">Chart 2</div>
        <div class="export-grid" id="exportGrid2"></div>
      </div>
    </div>
    <!-- Results -->
    <div class="export-results">
      <div class="export-result-box">
        <div class="export-chart-title">Chart 1 Results</div>
        <div id="exportResults1"></div>
      </div>
      <div class="export-result-box">
        <div class="export-chart-title">Chart 2 Results</div>
        <div id="exportResults2"></div>
      </div>
    </div>
    <!-- Matching Combinations -->
    <div class="export-result-box" style="width: 100%;">
      <div class="export-chart-title">Matching Combinations</div>
      <div id="exportMatches"></div>
    </div>
  </div>
</div>

<!-- External library for capturing images -->
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script>
  // Data storage for categories
  let currentCategories = {
    chart1: { '24-way': [], '12-way': [], '6-way': [], '4-way': [], '1-way': [] },
    chart2: { '24-way': [], '12-way': [], '6-way': [], '4-way': [], '1-way': [] },
    matches: { '24-way': [], '12-way': [], '6-way': [], '4-way': [], '1-way': [] }
  };

  // Initialize grids with default values
  window.onload = () => {
    initGrids();
    validateInputs();
  };

  function initGrids() {
    // Default values for the input grids
    const defaultValues1 = [
      '7','4','9','5',
      '2','1','6','3',
      '2','8','5','4',
      '6','6','4','3'
    ];
    const defaultValues2 = [
      '1','2','3','4',
      '2','3','5','6',
      '3','6','4','8',
      '4','5','6','7'
    ];
    createGrid('inputGrid1', defaultValues1);
    createGrid('inputGrid2', defaultValues2);
  }

  function createGrid(gridId, defaultValues) {
    const grid = document.getElementById(gridId);
    grid.innerHTML = '';
    for (let i=0; i<16; i++) {
      const input = document.createElement('input');
      input.type='number';
      input.min='0'; input.max='9';
      input.value=defaultValues[i];
      input.dataset.row=Math.floor(i/4);
      input.dataset.col=i%4;
      input.oninput=validateInputs;
      input.onblur=()=> {
        let val = parseInt(input.value);
        if (isNaN(val) || val<0) val=0;
        if (val>9) val=9;
        input.value=val;
        validateInputs();
      };
      grid.appendChild(input);
    }
  }

  function validateInputs() {
    const inputs1=document.querySelectorAll('#inputGrid1 input');
    const inputs2=document.querySelectorAll('#inputGrid2 input');
    const generateBtn=document.getElementById('generateBtn');

    let allFilled=true;
    for (const input of [...inputs1, ...inputs2]) {
      if (input.value.trim()==='' || isNaN(parseInt(input.value))) {
        allFilled=false;
        break;
      }
    }
    generateBtn.disabled=!allFilled;
  }

  function getColumnValues(gridId) {
    const inputs=document.querySelectorAll(`#${gridId} input`);
    const columns=[[],[],[],[]];
    inputs.forEach((inp,i)=>{
      const col=i%4;
      columns[col].push(inp.value);
    });
    return columns;
  }

  function generateGridCombinations(gridId) {
    const cols=getColumnValues(gridId);
    const combos=new Set();
    for (let a=0; a<4; a++) {
      for (let b=0; b<4; b++) {
        for (let c=0; c<4; c++) {
          for (let d=0; d<4; d++) {
            combos.add(`${cols[0][a]}${cols[1][b]}${cols[2][c]}${cols[3][d]}`);
          }
        }
      }
    }
    return Array.from(combos).sort();
  }

  function categorize(combos) {
    const categories={ '24-way': [], '12-way': [], '6-way': [], '4-way': [], '1-way': [] };
    combos.forEach(c => {
      const digits=c.split('');
      const unique=new Set(digits);
      const countUnique=unique.size;
      if (countUnique===4) categories['24-way'].push(c);
      else if (countUnique===3) categories['12-way'].push(c);
      else if (countUnique===2) {
        // check for 3 identical digits -> 4-way
        const counts={};
        digits.forEach(d=>counts[d]=(counts[d]||0)+1);
        if (Object.values(counts).includes(3)) categories['4-way'].push(c);
        else categories['6-way'].push(c);
      } else {
        categories['1-way'].push(c);
      }
    });
    return categories;
  }

  function generateCombinations() {
    if (!validateAllInputs()) {
      alert('Fill all boxes with numbers between 0-9 in both charts.');
      return;
    }
    // Generate for Chart 1 & 2
    currentCategories.chart1 = categorize(generateGridCombinations('inputGrid1'));
    currentCategories.chart2 = categorize(generateGridCombinations('inputGrid2'));
    findMatches();
    displayResults();
    document.getElementById('exportButtons').style.display='flex';
  }

  function validateAllInputs() {
    const allInputs=document.querySelectorAll('#inputGrid1 input, #inputGrid2 input');
    for (const inp of allInputs) {
      const val=inp.value.trim();
      if (val==='' || isNaN(parseInt(val))) return false;
    }
    return true;
  }

  function findMatches() {
    // Find intersection for each category
    for (const category of Object.keys(currentCategories.chart1)) {
      const set1=new Set(currentCategories.chart1[category]);
      const set2=new Set(currentCategories.chart2[category]);
      currentCategories.matches[category]=[...set1].filter(x=>set2.has(x)).sort();
    }
  }

  function displayResults() {
    const container=document.getElementById('output');
    container.innerHTML='';

    // Chart 1 & 2 Results
    const resultsDiv=document.createElement('div');
    resultsDiv.className='results-container';
    resultsDiv.appendChild(createResultsBox('Chart 1 Results', currentCategories.chart1));
    resultsDiv.appendChild(createResultsBox('Chart 2 Results', currentCategories.chart2));
    container.appendChild(resultsDiv);

    // Matching Combinations
    displayMatches();
  }

  function createResultsBox(title, categories) {
    const box=document.createElement('div');
    box.className='results-box';

    const h3=document.createElement('h3');
    h3.className='chart-title';
    h3.textContent=title;
    box.appendChild(h3);

    // Total count
    const totalCount=document.createElement('div');
    totalCount.className='total-count';
    totalCount.textContent=`Total: ${Object.values(categories).flat().length}`;
    box.appendChild(totalCount);

    // Category sections
    for (const [category, combos] of Object.entries(categories)) {
      if (combos.length===0) continue;
      const catDiv=document.createElement('div');
      catDiv.className='category';

      const catHeader=document.createElement('h3');
      catHeader.textContent=`${category} (${combos.length})`;
      catDiv.appendChild(catHeader);

      const resultsDiv=document.createElement('div');
      resultsDiv.className='results';

      combos.forEach(c => {
        const span=document.createElement('span');
        span.className='number' + (currentCategories.matches[category]?.includes(c) ? ' match' : '');
        span.textContent=c;
        resultsDiv.appendChild(span);
      });
      catDiv.appendChild(resultsDiv);
      box.appendChild(catDiv);
    }
    return box;
  }

  function displayMatches() {
    const container=document.getElementById('output');
    const section=document.createElement('div');
    section.className='matches-section';

    const title=document.createElement('h2');
    title.textContent='Matching Combinations';
    section.appendChild(title);

    const totalMatches=Object.values(currentCategories.matches).reduce((a,b)=>a+b.length,0);
    const totalDiv=document.createElement('div');
    totalDiv.className='total-count';
    totalDiv.textContent=`Total Matches: ${totalMatches}`;
    section.appendChild(totalDiv);

    if (totalMatches===0) {
      const msg=document.createElement('p');
      msg.style='text-align:center; font-style:italic;';
      msg.textContent='No matching combinations found.';
      section.appendChild(msg);
    } else {
      for (const [category, combos] of Object.entries(currentCategories.matches)) {
        if (combos.length===0) continue;
        const catDiv=document.createElement('div');
        catDiv.className='category';

        const catHeader=document.createElement('h3');
        catHeader.textContent=`${category} (${combos.length})`;
        catDiv.appendChild(catHeader);

        const resultsDiv=document.createElement('div');
        resultsDiv.className='results';

        combos.forEach(c => {
          const span=document.createElement('span');
          span.className='number match';
          span.textContent=c;
          resultsDiv.appendChild(span);
        });
        catDiv.appendChild(resultsDiv);
        section.appendChild(catDiv);
      }
    }
    container.appendChild(section);
  }

  function resetGrids() {
    document.querySelectorAll('#inputGrid1 input, #inputGrid2 input').forEach(inp => inp.value='');
    document.getElementById('output').innerHTML='';
    document.getElementById('exportButtons').style.display='none';
    validateInputs();
  }

  // ===================== Export Functions =====================
  function exportToText() {
    let text='===== 4D Box Chart Comparison Results =====\n';
    text+='Generated on '+new Date().toLocaleString()+'\n\n';
    // Charts
    text+='=== Charts ===\n';
    text+='Chart 1:\n'+getChartText('inputGrid1')+'\n';
    text+='Chart 2:\n'+getChartText('inputGrid2')+'\n';

    // Results
    text+='\n=== Results ===\n';
    text+=formatCategoriesText(currentCategories.chart1, 'Chart 1');
    text+=formatCategoriesText(currentCategories.chart2, 'Chart 2');

    // Matching
    text+='\n=== Matching Combinations ===\n';
    const totalMatches=Object.values(currentCategories.matches).reduce((a,b)=>a+b.length,0);
    text+=`Total Matches: ${totalMatches}\n`;
    text+=formatCategoriesText(currentCategories.matches, 'Matches', true);

    downloadTextFile(text, '4d_comparison_results.txt');
  }

  function getChartText(gridId) {
    const inputs=document.querySelectorAll(`#${gridId} input`);
    let lines=[];
    for (let i=0; i<16; i+=4) {
      lines.push(Array.from(inputs).slice(i,i+4).map(inp=>inp.value).join(' '));
    }
    return lines.join('\n');
  }

  function formatCategoriesText(categories, title='Categories', isMatch=false) {
    let txt='';
    for (const [category, combos] of Object.entries(categories)) {
      if (combos.length===0) continue;
      txt+=`${category} (${combos.length}):\n`;
      // Print in blocks of 8 per line
      for (let i=0; i<combos.length; i+=8) {
        const line=combos.slice(i,i+8).join(' ');
        txt+=line+'\n';
      }
      txt+='\n';
    }
    return txt;
  }

  function downloadTextFile(content, filename) {
    const blob=new Blob([content], {type:'text/plain'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url;
    a.download=filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // =================== Export as Image ===================
  function exportToImage() {
    // Prepare a clone of the export template
    const clone=document.getElementById('exportTemplate').cloneNode(true);
    Object.assign(clone.style,{
      display:'block',
      position:'absolute',
      top:'-9999px',
      left:'-9999px',
      width:'auto',
      height:'auto',
      zIndex:'9999'
    });
    // Set date
    clone.querySelector('#exportDate').textContent=new Date().toLocaleString();

    // Populate grids with current input data
    populateExportGrid('inputGrid1','exportGrid1',clone);
    populateExportGrid('inputGrid2','exportGrid2',clone);

    // Populate results summaries
    populateExportResultsText('exportResults1', currentCategories.chart1, clone);
    populateExportResultsText('exportResults2', currentCategories.chart2, clone);
    populateExportResultsText('exportMatches', currentCategories.matches, clone, true);

    document.body.appendChild(clone);

    // Capture the image
    html2canvas(clone, { scale:2, backgroundColor:'#ffffff' }).then(canvas => {
      document.body.removeChild(clone);
      const a=document.createElement('a');
      a.href=canvas.toDataURL('image/png');
      a.download='4d_comparison_results.png';
      a.click();
    });
  }

  function populateExportGrid(originalGridId, exportGridId, cloneContainer) {
    const originalInputs=document.querySelectorAll(`#${originalGridId} input`);
    const exportGrid=cloneContainer.querySelector(`#${exportGridId}`);
    // Clear previous cells
    exportGrid.innerHTML='';
    // Fill with current input values
    originalInputs.forEach(input => {
      const cell=document.createElement('div');
      cell.className='export-cell';
      cell.textContent=input.value;
      exportGrid.appendChild(cell);
    });
  }

  function populateExportResultsText(targetId, categories, cloneContainer, isMatch=false) {
    const target=cloneContainer.querySelector(`#${targetId}`);
    target.innerHTML='';

    // Header style
    const headerDiv=document.createElement('div');
    headerDiv.style='font-family:Arial,sans-serif; font-size:12px; font-weight:bold; color:#0066cc; margin-top:8px; margin-bottom:4px; border-bottom:1px solid #ccc; padding-bottom:2px;';
    headerDiv.textContent=isMatch?'Matching Combinations':'Categories';
    target.appendChild(headerDiv);

    // Loop categories
    for (const [category, combos] of Object.entries(categories)) {
      if (combos.length===0) continue;
      const catDiv=document.createElement('div');
      catDiv.style='margin-top:4px;';
      const catHead=document.createElement('div');
      catHead.style='font-family:Arial,sans-serif; font-size:11px; font-weight:bold; color:#333;';
      catHead.textContent=`${category} (${combos.length})`;
      catDiv.appendChild(catHead);

      // Show combos in blocks
      const blockDiv=document.createElement('div');
      blockDiv.style='display:flex; flex-wrap:wrap; gap:4px; margin-top:2px;';
      combos.forEach(c => {
        const span=document.createElement('div');
        span.className='number' + (isMatch ? ' match' : '');
        span.textContent=c;
        span.style='font-family:Courier New, monospace; font-size:11px; font-weight:bold; padding:2px 4px; border:1px solid #ccc; border-radius:3px; background-color:'+(isMatch?'#27ae60':'#f0f0f0')+'; color:'+(isMatch?'white':'black')+';';
        blockDiv.appendChild(span);
      });
      catDiv.appendChild(blockDiv);
      target.appendChild(catDiv);
    }
  }

</script>
</body>
</html>
